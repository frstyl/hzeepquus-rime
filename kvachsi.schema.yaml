# Rime schema
# encoding: utf-8

schema:
  schema_id: kvachsi
  name: 灮熙變
  version: "2025.09.13"
  author:
    - 
  description: |
    基于切韻廣韻
  dependencies:
    - luna_quanpin
    - cangjie6
switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 㢴文 ]
  - name: full_shape
    reset: 0
    states: [ 半寬, 全寬 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    reset: 1
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@pinyin
    - affix_segmentor@cangjie6_lookup
    - punct_segmentor
    - fallback_segmentor
  translators:
    - echo_translator
    - punct_translator
    - script_translator
    - script_translator@pinyin
    - script_translator@quanpin
    - table_translator@cangjie6
    - table_translator@cangjie6_lookup
  filters:
    - simplifier
    - uniquifier
    # - cjk_minifier
    - reverse_lookup_filter@lookup

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcbaABCDEFGHIJKLMNOPQRSTUVWXYZ'
  delimiter: "'"
  algebra:
####
 
    - derive/uo([qAs])/iov$1/ #o-v 虞愚
    - derive/wo([qAs])/xov$1/ #
    - derive/yo([qAs])/jov$1/ #
    - derive/Wo([qAs])/rov$1/ #
    - derive/uu([qAs])/rov$1/ #    孚幽

    - derive/oov([qAs])/ou$1/ #    侯

    - derive/([ir])uv([qAs])/$1u$2/ #  尤幽


##聲-介韻 -j -n

    - derive/([UywWu])i([ndztRr])/$1u$2/ #yu yi
    - derive/([UyWwu])i([qAs])/$1uj$2/ #e=ej i=ij
    - derive/([UyWwu])e(?=[ndztRr])/$1o$2/
    - derive/([UyWwu])e([qAs])/$1oj$2/ #e=ej i=ij


    - derive/Va([jrn][qAs])/Vu$1/
    - derive/Ua(n[qAs])/uo$1/ #    元
    - fuzz/i(m[qAs])/;$1/ #    陰
    - fuzz/(kh||k|g|c|H|q)xi(m[qAs])/$1i;$2/ #    陰
##介元
    - derive/[VY]([uo][jlrndztR])/$1/  # 配合o省

##聲介
#變
    - derive/^(ph|p|b|m)[Vv]([aou;,])/$1o$2/
    - derive/^(ph|p|b|m)[U]([ei;,])/$1I$2/
    # - derive/^(ph|p|b|m)[Yv]([ei;,])/$1e$2/ #无用  ##q不用

    - derive/^([Jl])i([aeiou;,])/$1j$2/
    - derive/^([Jl])u([aeiou;,])/$1y$2/

    - derive/^(tsh|ts|dz|s|zJ)i([aeiou;,])/$1j$2/
    - derive/^(tsh|ts|dz|s|zJ)u([aeiou;,])/$1y$2/
#渻補
    - derive/^([Jl])[ji]([aeiou;,])/$1$2/ #章J- 介前  聲母省介  #, tR->tRi?
    - derive/^([Jl])[yu]([aeiou;,])/$1$2/

    - derive/^((tsh|ts|dz|s|z|n)J)[ji]([aeiou;,])/$1$3/
    - derive/^((tsh|ts|dz|s|z|n)J)[yu]([aeiou;,])/$1$3/
#併聲母
    - derive/^(tsh|ts|dz|s|z)[SR][xi]([aeiou;,])/$1x$2/ #知莊R- 介前 #介省聲 #tx->tRi 
    - derive/^(tsh|ts|dz|s|z)[SR][wu]([aeiou;,])/$1w$2/
    - derive/^(tsh|ts|dz|s|z)[SR]([af])([aeiou;,])/$1$2$3/

    - derive/^(th|t|d|n)R([af])([aeiou;,])/$1$2$3/
    - derive/^(th|t|d|n)R[xi]([aeiou;,])/$1x$2/
    - derive/^(th|t|d|n)R[wu]([aeiou;,])/$1w$2/


    - derive/^tshJ[ji]([aeiou;,])/thj$1/
    - derive/^tshJ[yu]([aeiou;,])/thy$1/
    - derive/^tsJ[ji]([aeiou;,])/tj$1/
    - derive/^tsJ[yu]([aeiou;,])/ty$1/
    - derive/^dzJ[ji]([aeiou;,])/dj$1/
    - derive/^dzJ[yu]([aeiou;,])/dy$1/

    - derive/^nJ[ji]([aeiou;,])/nj$1/
    - derive/^nJ[yu]([aeiou;,])/ny$1/
    
    # - derive/^sJi([aeiou;,])/Hj$1/
    # - derive/^zJi([aeiou;,])/qj$1/

####介  主體
    - derive/V/v/
    - derive/Y/v/
    - derive/W/w/  #保畱
    - derive/W/vi/
    - derive/I/i/
    - derive/U/u/
    # - derive/vI(a|e|i|o|u|;|,)/U$1/
    - derive/I(a|e|i|o|u|;|,)/j$1/  #保畱
    - derive/U(a|e|i|o|u|;|,)/y$1/

    - xform/o([aeiou;,])/$1/
    - xform/e([aeiou;,])/$1/
    - xform/x([aeiou;,])/e$1/
    - xform/w([aeiou;,])/o$1/
    - xform/y([aeiou;,])/w$1/
    - xform/j([aeiou;,])/y$1/
    #- derive/v[jrxi]([aeiou;,]|ə|ʌ)/u$1/ #uə
    - fuzz/a([aeiou;,])/l$1/ #l=a   #保畱
##

    # - derive/(?<!^)[Ij]([aeiou;,])/$1/ #三 省#1.6 vio
    # - derive/([^RShv]|[^RS]h|^h)i([aeiou;,])/$1$2/ #i I j#未改
##?
    - derive/(?<!^)[Ijrx](a|e|i|o|u|;|,)/i$1/ #i=jx  #保畱
    - derive/(?<!^)[UyWw](a|e|i|o|u|;|,)/u$1/

##聲母轉寫 主體
    - derive/^(q)/xj/  #不需要
    - derive/^(A)/hq/ #影母
    - derive/^(E)/hz/ #匣母
    - derive/^(H)/hs/ #曉母
    #- derive/^(C)/ng/ #疑母
    - derive/^(th|t|d|n)R/$1r/ #知


    - derive/^(tsh|ts|dz|n|s|z)J/$1j/ #章 ?
    - derive/^tsJ/tj/ #章
    - derive/^dzJ/dj/
    - derive/^tshJ/thj/
    - derive/^nJ/nj/
####尾

    - xform/(?<!^)([ptk])q$/$1/ #入韻
    - xform/(?<!^)rq$/r/ #次入

    - derive/(?<!^)([Cmn])q$/$1/ #陽韻
    - fuzz/(?<!^)(ng|C|c)A$/g/
    - fuzz/(?<!^)(ng|C|c)s$/x/
    - fuzz/(?<!^)mA$/b/
    - fuzz/(?<!^)ms$/f/
    - fuzz/(?<!^)nA$/d/
    - fuzz/(?<!^)ns$/z/

    
    - fuzz/([aeiou;,])jq$/$1j/
    - fuzz/([aeiou;,])jA$/$1l/
    - fuzz/([aeiou;,])js$/$1r/
    - fuzz/([aeiou;,])vq$/$1v/
    - fuzz/([aeiou;,])vA$/$1w/
    - fuzz/([aeiou;,])vs$/$1y/
##𥳑尾

    - abbrev/([aeiou;,])j?q$/$1/
    - abbrev/([aeiou;,])j/$1/ #jq ~乘承前
    - abbrev/([aeiou;,])l/$1A/ 
    - abbrev/([aeiou;,])r/$1/ 
    - abbrev/([aeiou;,])A$/$1l/
    - abbrev/([aeiou;,])s$/$1r/

    - derive/([aeiou;,])[q]$/$1/ #无韻尾
    - derive/(?<!^)A$/q/  #主體
    - derive/(?<!^)Cq?$/c/

####𥳑
##介作元
    - derive/[Ii][;,]/i/  ##此乃有
    # - derive/(iu|[Uu][;,])/u/  #介元
    # - abbrev/([Vvo])u/v/ #v=vu #與首字母同級
##可選 介元序 尾後

    - abbrev/(?<!^)([oVveYlafUuyrWxw])([aeiou;,])([qAhsjlrvwymbfpndztRCcgxk])/$2$1$3/


##聲𥳑
    - derive/^(ng|C)/c/
    - derive/^J/j/
    # - derive/Q/q/
    #- derive/^Z/zz/
    
    - fuzz/^sJ(?=[jy])/x/ #書

    - derive/^(hz|E)/g/

    - derive/^z/Z/ #衺
    - derive/^dz/z/

    - derive/^ph/f/ #溷拼須爲derive
    - derive/^th/r/
    - derive/^kh/x/  #x xj
    - derive/^tsh/v/
    - derive/^ts/w/

    - xform/^(q)//    
    - derive/^(hq|A)/q/  ##hq
    - derive/^(hs|H)/h/ 


##𥳑 首字母
    # - abbrev/^(\w).+$/$1/
    # - abbrev/^(\w[zhcqs]?[lrfvjyxw]).+$/$1/ #介
    # - abbrev/^(tsh?|dz).+$/$1/
    # - abbrev/^([ptkw]h).+$/$1/
    # - abbrev/^(sz).+$/$1/
    # - abbrev/^([sz]c).+$/$1/
    # - abbrev/^(hz|hq).+$/$1/
    # - abbrev/^(ng).+$/$1/

    # - erase/^[a-z][zhcgqs].+$/
    # - abbrev/^([a-z])[^szhcgqrl].*$/$1/ #𥳑


    - abbrev/^([a-zA-Z])[aeiouVYvfIUjyxwə;,].*$/$1/ #𥳑
####轉寫 元音
    - derive/,/oe/
    - derive/;/eo/
    - derive/(;|,)/y/ #ə eo 

translator:
  dictionary: kvachqwins
  prism: kvachsi
  spelling_hints: 10
  enable_completion: false
  preedit_format:
    - xform/(^|')r(?!('|$))/$1tʰ$2/
    - xform/(^|')f(?!('|$))/$1pʰ$2/
    - xform/(^|')v(?!('|$))/$1t͡sʰ$2/
    # - xform/(^|')y(?!('|$))/$1kʰ$2/
    - xform/(^|')w(?!('|$))/$1t͡s$2/
    - xform/(^|')c(?!('|$))/$1ŋ$2/
    - xform/(^|')h(?!(['szq]|$))/$1ʔ$2/
    # - xform/eo/ə/
    # - xform/ea/ʌ/
    # - xform/hq/ʔ/
    # - xform/ng/ŋ/
    # - xform/hz/ɦ/
    - xform/([aeiou;,])h($|')/$1ʔ$2/
    - xform/([aeiou;,])c($|')/$1ŋ$2/
    # - xform/([aeiou;,])g($|')/$1ŋʔ$2/
    # - xform/([aeiou;,])x($|')/$1ŋs$2/
    # - xform/([aeiou;,])b($|')/$1mʔ$2/
    # - xform/([aeiou;,])f($|')/$1ms$2/
    # - xform/([aeiou;,])d($|')/$1nʔ$2/
    # - xform/([aeiou;,])z($|')/$1ns$2/
    # - xform/([aeiou;,])w($|')/$1vʔ$2/
    # - xform/([aeiou;,])y($|')/$1vs$2/
    # - xform/([aeiou;,])l($|')/$1jʔ$2/
    # # - xform/([aeiou;,])r($|')/$1js$2/
    - xform/;/ə/

    # - xform/hg/ʁ/
    # - xform/xz/ɣ/
    # - xform/xzq/ʁ/
    # - xform/xsq/ʁ/
    # - xform/ngq/ɴ/
    # - xform/qz/ɢ/
    # - xform/A/ʔ/
    # - xform/E/ɦ/
    # - xform/nR/ɳ/
    # - xform/S/ʃ/
    # - xform/Z/ʒ/
    # - xform/sJ/ɕ/
    # - xform/zJ/ʑ/
    # - xform/sR/ʂ/
    # - xform/zR/ʐ/
    # - xform/tsJ/t͡ɕ/
    # - xform/dzJ/d͡ʑ/
    # - xform/tS/t͡ʃ/
    # - xform/dZ/d͡ʒ/
    # - xform/tsR/t͡ʂ/
    # - xform/dzR/d͡ʐ/
    # - xform/pF/p͡ɸ/
    # - xform/bF/B͡β/
    # - xform/nF/ɱ/
    # - xform/tR/ʈ/
    # - xform/dR/ɖ/
    # - xform/([A-Z])O/$1ˤ/
    # - xform/([A-Z])V/$1ʷ/
    # - xform/(.+)H/\L$1ʰ/
    # - xform/([aeiou;,])q($|')/$1 $2/
  comment_format:

    - xform/;/ə/
    - xform/,/ʌ/
    - xform/([mnCptkr])q($|')/$1$2/

    - xform/A/ʔ/
    - xform/E/ɦ/
    - xform/^(t?)sJ/$1ɕ/
    - xform/^tshJ/tɕh/
    - xform/^(d?)zJ/$1ʑ/
    - xform/^(t?)sS/$1ʃ/
    - xform/^tshS/tʃh/
    - xform/^(d?)zS/$1ʒ/
    # - xform/sR/ʂ/
    # - xform/zR/ʐ/
    # - xform/tR/ʈ/
    # - xform/dR/ɖ/

    - xform/C/ŋ/
    # - xform/([rs])[ptk]($|')/$1/
  initial_quality: 0.7

quanpin:
  dictionary: luna_pinyin
  prism: luna_quanpin
  enable_completion: false
  prefix: ""
  # suffix: "'"
  tips: 〔quanpin〕
  tag: quanpin
  # closing_tips:
  # # contextual_suggestions: 
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue('|$)/$1üe$2/
    - xform/([jqxy])v/$1ü/
  initial_quality: 0.5

pinyin:
  dictionary: luna_pinyin
  prism: luna_pinyin
  prefix: "~"
  suffix: "'"
  tips: 〔pinyin〕
  tag: pinyin
  # closing_tips:
  # # contextual_suggestions: 
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue('|$)/$1üe$2/
    - xform/([jqxy])v/$1ü/

cangjie6:
  dictionary: cangjie6
  prism: cangjie6
  enable_charset_filter: false
  enable_sentence: false
  enable_encoder: false
  encode_commit_history: false
  enable_completion: false
  enable_user_dict: false
  prefix: ""
  tips: 〔倉頡6〕
  tag: cangjie6
  # closing_tips:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|
  comment_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片～|"
  initial_quality: 0.6

cangjie6_lookup:
  dictionary: cangjie6
  prism: cangjie6
  enable_charset_filter: false
  prefix: "`"
  suffix: "'"
  tips: 〔倉頡6〕
  tag: cangjie6_lookup
  # closing_tips:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|
  comment_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片～|"

abc_segmentor: #混用
  extra_tags: [quanpin]

lookup:
  tags: [pinyin,cangjie6_lookup]
  dictionary: kvachqwins
  # overwrite_comment: true
  comment_format:
    - xform/-//
    - xform/_//
    - xform/;/ə/
    - xform/,/ʌ/
punctuator:
  import_preset: symbols
menu:
  page_size:10
key_binder:
  import_preset: default
  bindings:
ascii_composer:
    good_old_caps_lock: true
    switch_key: {Caps_Lock: noop, Control_L: noop, Control_R: noop, Eisu_toggle: clear, Shift_L: commit_code, Shift_R: commit_code}

recognizer:
  import_preset: default
  patterns:
    email: "^[a-z][-_.0-9a-z]*@.*$"
    # punct: '^/([0-9]0?|[A-Za-z]+)$' #配合symbols.yaml中的特殊字符輸入
    punct: "^/[0-9a-zA-Z]*$" #配合symbols.yaml中的特殊字符輸入
    pinyin: "^~[a-z]*'?$"
    cangjie6_lookup: "^`[a-z]*'?$"
