# Rime schema
# encoding: utf-8

schema:
  schema_id: hzeepqwiz_z
  name: 叶韻全拼
  version: "2023.10.1"
  author:
    - 
  description: |
    叶韻全拼與反察

  dependencies:
    - luna_pinyin
    - cangjie6

switches:
  - name: ascii_mode
    reset: 0
    states: [ 中文, 㢴文 ]
  - name: full_shape
    reset: 0
    states: [ 半寬, 全寬 ]
  - name: simplification
    states: [ 漢字, 汉字 ]
  - name: ascii_punct
    reset: 1
    states: [ 。，, ．， ]

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - affix_segmentor@pinyin_lookup
    - affix_segmentor@cangjie6_lookup
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator
    - script_translator@pinyin_lookup
    - table_translator@cangjie6_lookup
  filters:
    - simplifier
    - uniquifier
    - reverse_lookup_filter@lookup

speller:
  alphabet: 'zyxwvutsrqponmlkjihgfedcbaABCDEFGHIJKLMNOPQRSTUVWXYZ'
  delimiter: " '"
  algebra:
###########
    #- derive/-//
    - derive/_//
    #- derive/._// #无用
    - derive/[FQ]_// #无用
    - derive/,/ʌ/
    - derive/;/ə/
    - derive/ʌ/oe/
    - derive/ə/eo/

    #- derive/u/Vi/ # u o
    #- derive/y/Vj/ #
    #- derive/U/VI/ # u o
    #- derive/f/Va/
    #- derive/w/Vx/
    #- derive/W/Vr/
    #- derive/v/Vo/

    - derive/^k(h?)L(?!-)/t$1/ #kL t #kL tsc#CL缺#合甚叕出 穿川舛車樞杵處楢醜臭饎出赤
    - derive/^gL(?!-)/d/
    - derive/^([sz])KL(?!-)/$1/ #缺 Ls?skL?

    - derive/^(.+)-J[Lq]/$1L/

    - derive/^(kh|[kgCAXh])L/$1/  #k-L
    

    - derive/^([sz])[ptkmnCLRQq]-J/$1J/ #s-[] sc
    - derive/^([sz])[ptkmnCLRQq]-R/$1S/ #sR

    - derive/^([sz])[ptkmnCLRQq]-(?![JR])/$1/ #s-[] 
    - derive/-//
    - derive/.-//


    - derive/^(h[mnCLRqQ]s|hsq|ngs|[mnCqQ]s|[hX]s|X)/h/

    - derive/^h?[mnCLRqQ](s)J/$1J/ #[]s #Ls→hLs→LsJ,  L→LJ?→JL
    - derive/^[mnCLRqQ](z)J/$1J/ #[]s #Ls→hLs→LsJ,  L→LJ?→JL
    - derive/^[mnCLRqQ]([sz])R/$1S/ #Lsc LsS #不存在

##聲介

    #- derive/([SR]h?)i([aeiou;,])/$1x$2/ #知莊R-
    #- derive/([SR]h?)u([aeiou;,])/$1w$2/
    #- derive/(Jh?|[sz]|sh|^J|^l)i([aeiou;,])/$1j$2/
    #- derive/(Jh?|[sz]|sh|^J|^l)u([aeiou;,])/$1y$2/
##
    #- derive/^(th|t|d|n)[JR]/$1/
    #- derive/^(t?s|d?z)S/$1/ #tsz sz
    - derive/^(J[LQq])/J/ #Jq

    - derive/^(kh|k|g|C)Q/$1/
    - derive/^(E|hz)/g/
    - derive/^(J[QVLq])/q/    #Jq
    - derive/^(E|hz|hg|hQ(?!s))/E/

    #- derive/^(.*L)[JR]/$1/ ##ll=L(![sz]) #包括L- #作jr1228
    #- derive/^([sz][ptkmnCLRQq])[JR]/$1/ #心生書s ss

    #- derive/^(Rsh[RJ]?|RsR)/Rs/    #RsS? hR與X-R悖 #1228
    #- derive/^(RzR|R(?![s])[R]?|l)/Rz/ #R-无J, 无s-R類
    #- derive/^(hLsJ|Lsh[RJ]?|Ls[RJ]?|hLs)/Ls/
    #- derive/^(Lz[RJ]|L[RJ]|JL|L(?![s]))/Lz/ #Lzc? Lc?
    #- derive/^(hms|msF?)/ms/
    #- derive/^(hns[RJ]|hns|nsh|ns[RJ])/ns/
    #- derive/^(hCs[RJ]|hCs|Cs[RJ])/Cs/
    #- derive/^(hQs)/Qs/
    #- derive/^(h?Q(?![sz]))/Qz/ #QsJ?
    #- derive/^([RLQ][s])/\L$1/ #R L Q雲
    #- derive/^(h[mnCLRqQV]sJ?|hsq|ngs|[mnCqQV]sJ?)/hs/
    
    - derive/^(h[mnCLRqQV]s|hsq|ngs|[mnCqQV]s|hs)/hs/ #1228

    - derive/^(JL|Lz?)/j/ #以L
    - derive/^(hLs|Lsh|Ls)/ls/ 
    - derive/^(hLs|Rsh|Rs)/rs/ 
    - derive/^(hQs)/qs/
    - derive/^(hms|msF?)/ms/
    - derive/^(hns|nsh|ns)/ns/
    - derive/^(hCs|Cs)/Cs/
    - derive/^(A)/hq/ #影母
    - derive/^(E)/hz/ #匣母
    #- derive/^(C)/ng/ #疑母


    - derive/^([sz])J/$1z/ #書船

    - derive/([SRJ](?![qAs ]))/\L$1/ #轉寫
    #- derive/^(ph?|b|ms?)/P/
    #- derive/^(th?|d|ns?)/T/
    #- derive/^(tsh?|t?s|d?z)/Z/ #
    #- derive/^(kh?|g|Cs?)/K/
    #- derive/^(A|h|E)/G/

    #- derive/^(Q|hQ|JQ)/KV/
    #- derive/^(pFh|pF|bF|mF)(?!$)/PF/
    #- derive/^(tsch|d?zc|t?sc|J)/D/
##
    #- derive/(a)a([qAs])/$1o$2/ #二等 aa ao
    #- derive/V([UywWu]o)([qAs])/$1v$2/ #o-v 
    - derive/uo([qAs])/iov$1/ #o-v 虞愚
    - derive/wo([qAs])/xov$1/ #
    - derive/yo([qAs])/jov$1/ #
    - derive/Wo([qAs])/rov$1/ #
    - derive/uu([qAs])/rov$1/ #    孚幽
    - derive/(u)v/$1/ #uv
    - derive/([oir]u)v([qAs])$/$1$2/ #u-v 侯尤幽
    - derive/(u)v/$1/ #uv 侯尤幽

    - derive/(i)j/$1/
    - derive/([ov][au])j/$1/
##
    - derive/([SR]h?)i([aeiou;,])/$1x$2/ #知莊R- 介前
    - derive/([SR]h?)u([aeiou;,])/$1w$2/
    - derive/(^[Jl]|[cJ]h?)i([aeiou;,])/$1j$2/
    - derive/(^[Jl]|[cJ]h?)u([aeiou;,])/$1y$2/
##
    - derive/Y/v/
    - derive/W/w/
    - derive/I/j/
    - derive/U/y/
    # - fuzz/[jrxI](ə|ʌ|a|e|i|o|u|;)/i$1/ #i=jx
    # - fuzz/[ywU](ə|ʌ|a|e|i|o|u|;)/u$1/

##    
    - fuzz/(Sh?)a([aeiou;,])/$1r$2/ #莊R 聲前介後
    - fuzz/(Sh?)f([aeiou;,])/$1W$2/ #莊

    - derive/([jIi])([ʌə;,])/i/ #之 介元
    - derive/([yUu]|V[jIi])([ʌə;,])/u/  #i u əʌ 元音半元音
    - derive/[oe][əʌ;,]/ea/ 
# # # # # # # 
    #- derive/^([A-Zbcdghklmnpqrstz]+)(?!$)/B/ #聲

    #- derive/^(pFh|pF|bF|mF|ph|p|b|m)(?!$)/Ip/
    #- derive/^((th|t|d|n)[RJ]?|[sz]t[SJ]?)(?!$)/It/
    #- derive/^(tsS?h|d?zS?|t?sS?)(?!$)/Its/
    #- derive/^([sz][S]?)(?!$)/Is/
  
    #- derive/^(ng[qc]?|C[qc]?|kh?[qc]?|gc?|hg|[sz][kCq][sc]?|X)(?!L)/Ik/
    #- derive/^(ng|C|kh?|g|hg|sq|X|h)L[qJ]?(?!$)/IkL/
    #- derive/^(x[sz]|hz|xq|hq|h|E|A)(?!$)/Ih/

#
    #- derive/^([sz][kqC][SJ]?|h[Cq]s|ng[qSJ]?|C[qSJ]?|kh?[Jq]?|gJ?|hz|hg|E|hqz|Xqz|Xq|Xz|qs|Jq|q|hq|A|h|X)(?!$)/IK/
    #- derive/^((L(sh)?[RJ]?)|(L[sz]J)|[sz]Ls?|JL?)(?!$)/IL/
    #- derive/^((R(z?|sh))|[sz]R[SJ]?|.l)(?!$)/IR/
    #- derive/^(h?ms|[sz]m[SJ]?|mF?)(?!$)/IM/
    #- derive/^(hns|ns[RJ]?|[sz]n[SJ]?|n[RJ]?)(?!$)/IN/
    #- derive/^(hCs|[sz]C[SJ]?|ng[qSJ]?|C[qSJ]?)(?!$)/IC/
# #
    #- derive/(v?[oeviujyxwaf]?)([aeiou]|ə|ʌ|;|,)([qAsjlrvwyCgxkmbfpndzt]([ptk]|sk)?)$/B/
    #- derive/(v?[oeviujyxwaf]?)([aeiou]|ə|ʌ|;|,)([qAsjlrvwyCgxkmbfpndzt]([ptk]|sk)?)$/$1B/
    #- derive/(v?[oeviujyxwaf]?)([aeiou]|ə|ʌ|;|,)([qAsjlrvwyCgxkmbfpndzt]([ptk]|sk)?)$/B$2B/

    #- derive/(v?[oeviujyxwaf]?)([aeiou]|ə|ʌ)([qAsjlrvwyCgxkmbfpndzt]([ptk]|sk)?)$/B$3/
    #- derive/(v?[oeviujyxwaf]?)([aeiou]|ə|ʌ)([qAsjlrvwyCgxkmbfpndzt]([ptk]|sk)?)$/$1$2B/
    #- derive/(v?[oeviujyxwaf]?)([aeiou]|ə|ʌ)([qAsjlrvwyCgxkmbfpndzt]([ptk]|sk)?)$/$1B$3/
    #- derive/(v?[oeviujyxwaf]?)([aeiou]|ə|ʌ)([qAsjlrvwyCgxkmbfpndzt]([ptk]|sk)?)$/B$2$3/
# # ##

    #- derive/(?<!^)([jv])[q]$/$1/ #侌韻
    #- derive/(?<!^)([ptk])q$/$1/ #入韻
    #- derive/(?<!^)([mnC])q$/$1/ #陽韻
    - derive/(?<!^)([aeiou;,jvmnCptkrR])([qAs])$/$1/

    - derive/(?<!^)A$/h/

    - derive/(?<!^)jA$/l/
    - derive/(?<!^)js$/r/
    - derive/(?<!^)vA$/w/
    - derive/(?<!^)vs$/y/   
  #  - derive/(?<!^)([fvIUjyxwaeiouəʌ;,][aeiouəʌ;,])j[qAs]$/$1i$2/ #侌韻 #-j-v視爲韻
  #  - derive/(?<!^)([fvIUjyxwaeiouəʌ;,][aeiouəʌ;,])v[qAs]$/$1u$2/ #


   # - derive/(?<!^)([fvIUjyxwaeiouəʌ;,][aeiouəʌ;,])v(k)$/$1u$2/ #-v-視爲韻 u
    # - derive/(?<!^)v(k)$/$1/
    #- fuzz/(?<!^)v(k)$/$1/

    - derive/(?<!v)ks$/s/ #次入
    - derive/(?<!v)[pt]s$/r/
    - derive/(?<!v)rq$/r/
    - derive/(?<!^)vks$/vs/
    - derive/(?<!^)vks$/y/


    - derive/(?<!^)(ng|C|c)q$/c/
    - derive/(?<!^)(ng|C|c)A$/g/
    - derive/(?<!^)(ng|C|c)s$/x/
    - derive/(?<!^)mA$/b/
    - derive/(?<!^)ms$/f/
    - derive/(?<!^)nA$/d/
    - derive/(?<!^)ns$/z/
    

##轉寫
    - derive/-//
    - derive/_//

    #- derive/A/hq/
    #- derive/E/hz/
    #- derive/C/ng/
    #- derive/S/ss
    #- derive/F/fs/
    - derive/C/c/
    #- derive/V/vv/
    - derive/R(?![sz])/rr/
    - derive/L(?![sz])/ll/

    # - derive/(ʌ|ə)/;/ #EOə eo
    - derive/oʌ/ʌ/
    - derive/eə/ə/
    - derive/ʌ/oe/
    - derive/ə/eo/
    - derive/(ʌ|ə)/ea/
##
    - abbrev/([jx])i/$1/ #半元作元 配下u o
    - abbrev/([yw])i/$1/ #ju vi溷
    - abbrev/([Uyw])u/y/ 
    - abbrev/([vo])u/v/ #v=vu
    - abbrev/([iuIU])u/u/ 
##
    - fuzz/^J/j/
    - derive/Q/q/
    #- derive/^Z/zz/

    - fuzz/^dz(?!c)/z/

    - fuzz/^ph/f/
    - fuzz/^th/r/
    - fuzz/^kh/y/
    - fuzz/^ts(s?)h/v$1/
    - fuzz/^ts(?!c)/x/
    - fuzz/^(hq|A)/w/
    - fuzz/^(ng|C)/c/
translator:
  dictionary: hzeepqwiz
  prism: hzeepqwiz_z
  spelling_hints: 10
  prism: hzeepqwiz_z
  comment_format:
    - xform/[-_]//

pinyin_lookup:
  dictionary: luna_pinyin
  prism: luna_pinyin
  prefix: "~"
  suffix: "'"
  tips: 〔pinyin〕
  tag: pinyin_lookup
  # closing_tips:
  # # contextual_suggestions: 
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue('|$)/$1üe$2/
    - xform/([jqxy])v/$1ü/
cangjie6_lookup:
  dictionary: cangjie6
  prism: cangjie6
  enable_charset_filter: false
  prefix: "`"
  suffix: "'"
  tips: 〔倉頡6〕
  tag: cangjie6_lookup
  # closing_tips:
  preedit_format:
    - xlit|abcdefghijklmnopqrstuvwxyz|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片|
  comment_format:
    - "xlit|abcdefghijklmnopqrstuvwxyz~|日月金木水火土竹戈十大中一弓人心手口尸廿山女田止卜片～|"

lookup:
  tags: [pinyin_lookup,cangjie6_lookup]
  dictionary: hzeepqwiz
  overwrite_comment: false

punctuator:
  import_preset: default
menu:
  page_size:10

key_binder:
  import_preset: default

recognizer:
  import_preset: default
  patterns:
    pinyin_lookup: "^~[a-z]*'?$"
    cangjie6_lookup: "^`[a-z]*'?$"
